import{_ as y,m as L,k as w,p as S,r as _,o as r,a as d,h as l,b as s,F as f,d as k,f as b,t as n,j as v,i as E,l as T,n as h,e as N,v as C}from"./index-ADMgmOFv.js";import{S as P}from"./sweetalert2.all-CAdgv-ta.js";import{c as g}from"./cartStore-D0Hoi1su.js";var U={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"dorayu",BASE_URL:"/vite-deploy-week08/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:F,VITE_PATH:M}=U,j={data(){return{form:{data:{user:{name:"",email:"",tel:"",address:""},message:""}}}},computed:{...L(g,["isLoading","cartList","finalPrice"])},methods:{...w(g,["getCarts"]),isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼"},createOrder(){const t=`${F}/api/${M}/order`,{form:e}=this;this.cartList.length!==0&&this.axios.post(t,e).then(c=>{S.success(c.data.message),this.$refs.form.resetForm(),this.form.data.message="",this.getCarts(),this.$router.push(`/payment/${c.data.orderId}`)}).catch(c=>{P.fire(c.response.data.message)})}},mounted(){this.getCarts()}},D={class:"container g-wrapper"},I=T('<div class="row d-flex justify-content-between align-items-center border-bottom py-4 my-5"><h2 class="cart-title col-12 col-md-2">購物車</h2><div class="cart-step col-12 col-md-10"><div class="box"><span class="deco">STEP1</span>購物車 </div><div class="box current"><span class="deco">STEP2</span>訂購資訊 </div><div class="box"><span class="deco">STEP3</span>確認付款 </div></div></div>',1),R={class:"row"},q={class:"col-12 col-md-6"},A=s("h5",null,"購物清單",-1),B={class:"pe-4"},O={key:0},H={class:"table align-middle"},z=s("thead",{class:"table-dark"},[s("tr",null,[s("th",null,"圖片"),s("th",null,"品名"),s("th",{style:{width:"150px"}},"數量/單位"),s("th",{class:"text-end"},"小計")])],-1),$=["src"],G={class:"text-end"},J={key:1,class:"bg-light p-4"},K={class:"pe-4"},Q={class:"mb-4"},W={class:"border-bottom border-dark"},X={class:"d-flex justify-content-between"},Y=s("p",null,"小計：",-1),Z={class:"text-notoSans"},ss={key:0,class:"d-flex justify-content-between mb-4"},ts=s("p",{class:"text-nowrap"},"優惠卷折扣：",-1),es={class:"text-notoSans"},as={class:"d-flex justify-content-between my-3"},os=s("p",{class:"fw-bold"},"合計：",-1),ls={class:"fw-bold text-end"},is={class:"text-notoSans fs-4"},ns={key:0,class:"d-flex text-danger"},rs={class:"col-12 col-md-6"},ds=s("h5",null,"聯絡資訊",-1),cs={class:"bg-light p-3"},ms={class:"mb-3"},us=s("label",{for:"email",class:"form-label"},"Email",-1),_s={class:"mb-3"},hs=s("label",{for:"name",class:"form-label"},"收件人姓名",-1),ps={class:"mb-3"},fs=s("label",{for:"tel",class:"form-label"},"收件人電話",-1),bs={class:"mb-3"},vs=s("label",{for:"address",class:"form-label"},"收件人地址",-1),gs={class:"mb-3"},xs=s("label",{for:"message",class:"form-label"},"留言",-1),Vs=s("div",{class:"text-end"},[s("button",{type:"submit",class:"btn btn-primary text-white px-5"},"送出訂單")],-1);function ys(t,e,c,Ls,o,p){const x=_("VueLoading"),m=_("VField"),u=_("ErrorMessage"),V=_("VForm");return r(),d(f,null,[l(x,{active:t.isLoading},null,8,["active"]),s("div",D,[I,s("div",R,[s("div",q,[A,s("div",B,[this.cartList.carts&&this.cartList.carts.length>0?(r(),d("div",O,[s("table",H,[z,s("tbody",null,[(r(!0),d(f,null,k(t.cartList.carts,a=>(r(),d("tr",{key:a.id},[s("td",null,[s("img",{class:"img-cart",src:a.product.imageUrl,alt:""},null,8,$)]),s("td",null,n(a.product.title),1),s("td",null,n(a.qty)+" / "+n(a.product.unit),1),s("td",G,n(a.total),1)]))),128))])])])):(r(),d("div",J,"購物車沒有任何品項"))]),s("div",K,[s("div",Q,[s("div",W,[s("div",X,[Y,s("p",null,[b("NT$ "),s("span",Z,n(t.cartList.total),1)])]),t.cartList&&t.cartList.carts&&t.cartList.carts.length>0&&t.cartList.carts[0].coupon?(r(),d("div",ss,[ts,s("p",null,[s("span",es," NT $"+n(Math.floor(t.cartList.total-t.cartList.final_total)),1)])])):v("",!0)]),s("div",as,[os,s("p",ls,[b(" NT$ "),s("span",is,n(Math.round(t.cartList.final_total)),1),this.cartList.carts&&this.cartList.carts.length>0&&this.cartList.carts[0].coupon?(r(),d("span",ns," (已使用"+n(this.cartList.carts[0].coupon.title)+")",1)):v("",!0)])])])])]),s("div",rs,[ds,s("div",cs,[l(V,{onSubmit:p.createOrder,ref:"form"},{default:E(({errors:a})=>[s("div",ms,[us,l(m,{type:"email",class:h(["form-control",{"is-invalid":a.email}]),id:"email",name:"email",placeholder:"請輸入Email",rules:"email|required",modelValue:o.form.data.user.email,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.data.user.email=i)},null,8,["class","modelValue"]),l(u,{class:"invalid-feedback",name:"email"})]),s("div",_s,[hs,l(m,{type:"text",class:h(["form-control",{"is-invalid":a.姓名}]),id:"name",name:"姓名",placeholder:"請輸入姓名",rules:"required",modelValue:o.form.data.user.name,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.data.user.name=i)},null,8,["class","modelValue"]),l(u,{class:"invalid-feedback",name:"姓名"})]),s("div",ps,[fs,l(m,{type:"text",class:h(["form-control",{"is-invalid":a.tel}]),id:"tel",name:"tel",placeholder:"請輸入電話: 09xxxxxxxxx",rules:p.isPhone,modelValue:o.form.data.user.tel,"onUpdate:modelValue":e[2]||(e[2]=i=>o.form.data.user.tel=i)},null,8,["class","rules","modelValue"]),l(u,{class:"invalid-feedback",name:"tel"})]),s("div",bs,[vs,l(m,{type:"text",class:h(["form-control",{"is-invalid":a.地址}]),id:"address",name:"地址",placeholder:"請輸入地址",rules:"required",modelValue:o.form.data.user.address,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.data.user.address=i)},null,8,["class","modelValue"]),l(u,{class:"invalid-feedback",name:"地址"})]),s("div",gs,[xs,N(s("textarea",{name:"message",id:"message",class:"form-control",cols:"30",rows:"5","onUpdate:modelValue":e[4]||(e[4]=i=>o.form.data.message=i)},null,512),[[C,o.form.data.message]])]),Vs]),_:1},8,["onSubmit"])])])])])],64)}const Es=y(j,[["render",ys]]);export{Es as default};
