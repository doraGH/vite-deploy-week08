import{S as p}from"./sweetalert2.all-CAdgv-ta.js";import{_ as x,p as _,o as c,a as u,b as t,t as a,e as y,K as D,F as O,d as T,v as E,j as L,w as b,r as h,h as m,n as v,f as w}from"./index-ADMgmOFv.js";import{P as A}from"./PaginationComponent-4HMo1ozH.js";import{m as P}from"./modalMixin-PsvJ455v.js";import"./scrollbar-Ux6MPrIQ.js";var $={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"dorayu",BASE_URL:"/vite-deploy-week08/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:U,VITE_PATH:B}=$,I={props:["tempOrder","getOrders"],emit:["edit-order"],mixins:[P],data(){return{editOrder:{data:{}}}},mounted(){this.editOrder=this.tempOrder},methods:{updateOrder(){const d=this.editOrder.data.id,s=`${U}/api/${B}/admin/order/${d}`;this.axios.put(s,this.editOrder).then(e=>{_.success(e.data.message),this.modal.hide(),this.$emit("updateOrder")}).catch(e=>{const i=Array.isArray(e.response.data.message)?e.response.data.message.join(`
`):e.response.data.message;_.error(i)})},formatDate(d){return new Date(d*1e3).toLocaleDateString()}},watch:{tempOrder(){this.editOrder=this.tempOrder}}},R={class:"modal fade",id:"orderModal",ref:"modal",tabindex:"-1","aria-labelledby":"orderModallLabel","aria-hidden":"true"},S={class:"modal-dialog modal-xl"},H={class:"modal-content border-0"},N=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},F=t("h6",null,"訂單內容",-1),q={class:"table"},z=t("th",null,"訂單編號",-1),K=t("th",null,"訂單日期",-1),G=t("th",null,"付款狀態",-1),J={class:"form-check"},Q={class:"form-check-label",for:"is_paid"},W={key:0,class:"text-success"},X={key:1,class:"text-muted"},Y=t("th",null,"總金額",-1),Z=t("h6",null,"選購商品",-1),tt={class:"table"},et=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",{class:"text-end"},"單價")])],-1),st=["src"],dt={class:"text-end"},nt=t("h6",null,"用戶資料",-1),at={class:"table"},ot={key:0},rt=t("td",null,"姓名",-1),lt=t("td",null,"Email",-1),it=t("td",null,"電話",-1),ct=t("td",null,"地址",-1),ut={class:"modal-footer"},_t=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ht(d,s,e,i,o,r){return c(),u("div",R,[t("div",S,[t("div",H,[N,t("div",j,[F,t("table",q,[t("tbody",null,[t("tr",null,[z,t("td",null,a(e.tempOrder.data.id),1)]),t("tr",null,[K,t("td",null,a(r.formatDate(e.tempOrder.data.create_at)),1)]),t("tr",null,[G,t("td",null,[t("div",J,[y(t("input",{class:"form-check-input",type:"checkbox",id:"is_paid","onUpdate:modelValue":s[0]||(s[0]=n=>o.editOrder.data.is_paid=n),"true-value":!0,"false-value":!1},null,512),[[D,o.editOrder.data.is_paid]]),t("label",Q,[e.tempOrder.data.is_paid?(c(),u("span",W,"已付款")):(c(),u("span",X,"未付款"))])])])]),t("tr",null,[Y,t("td",null," $ "+a(e.tempOrder.data.total),1)])])]),Z,t("table",tt,[et,t("tbody",null,[(c(!0),u(O,null,T(e.tempOrder.data.products,n=>(c(),u("tr",{key:n.id},[t("td",null,[t("img",{class:"img-cart",src:n.product.imageUrl,alt:""},null,8,st)]),t("td",null,a(n.product.title),1),t("td",null,a(n.qty)+" / "+a(n.product.unit),1),t("td",dt," $ "+a(n.final_total),1)]))),128))])]),nt,t("table",at,[e.tempOrder.data.user?(c(),u("tbody",ot,[t("tr",null,[rt,t("td",null,a(e.tempOrder.data.user.name),1)]),t("tr",null,[lt,t("td",null,a(e.tempOrder.data.user.email),1)]),t("tr",null,[it,t("td",null,a(e.tempOrder.data.user.tel),1)]),t("tr",null,[ct,t("td",null,[y(t("input",{id:"address",type:"text",class:"form-control",placeholder:"請輸入地址","onUpdate:modelValue":s[1]||(s[1]=n=>o.editOrder.data.user.address=n)},null,512),[[E,o.editOrder.data.user.address]])])])])):L("",!0)])]),t("div",ut,[_t,t("button",{type:"button",class:"btn btn-primary",onClick:s[2]||(s[2]=b((...n)=>r.updateOrder&&r.updateOrder(...n),["prevent"]))}," 確認 ")])])])],512)}const mt=x(I,[["render",ht]]);var pt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"dorayu",BASE_URL:"/vite-deploy-week08/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:g}=pt,ft={data(){return{orders:[],pagination:{},tempOrder:{data:{}},isLoading:!1}},components:{PaginationComponent:A,OrderModal:mt},methods:{getOrders(d=1){const s=`${f}/api/${g}/admin/orders?page=${d}`;this.isLoading=!0,this.axios.get(s).then(e=>{const{orders:i,pagination:o}=e.data;this.isLoading=!1,this.orders=i,this.pagination=o,_.success("成功取得訂單")}).catch(e=>{_.error(e.response.data.message)})},formatDate(d){return new Date(d*1e3).toLocaleDateString()},delOneOrder(d){const s=`${f}/api/${g}/admin/order/${d}`;p.fire({title:"確定要刪除訂單嗎?",showDenyButton:!0,confirmButtonText:"是，我要刪除",denyButtonText:"不要刪除"}).then(e=>{e.isConfirmed&&this.axios.delete(s,d).then(i=>{_.success(i.data.message),this.getOrders()}).catch(i=>{_.error(i.response.data.message)})})},delAllOrder(){const d=`${f}/api/${g}/admin/orders/all`;p.fire({title:'確定要清空<span class="text-danger">全部</span>訂單嗎?',showDenyButton:!0,confirmButtonText:"是，我要刪除",denyButtonText:"不要刪除"}).then(s=>{s.isConfirmed&&this.axios.delete(d).then(e=>{_.success(e.data.message),this.getOrders(),p.fire("您已刪除全部訂單")}).catch(e=>{_.error(e.response.data.message)})})},openOrderModal(d,s){d==="edit"?(this.tempOrder.data={...s},this.$refs.orderModal.openModal()):d==="delete"&&(this.tempOrder.data={...s},this.$refs.delModal.openModal())}},mounted(){this.getOrders()}},gt={class:"container"},Ot={class:"d-flex justify-content-between mt-4"},bt=t("h2",null,"訂單列表",-1),yt={class:"text-end"},vt={class:"table align-middle"},xt=t("thead",null,[t("tr",null,[t("th",null,"訂單日期"),t("th",null,"訂單編號"),t("th",null,"訂單總金額"),t("th",null,"付款狀態"),t("th",null,"查看訂單")])],-1),Tt={class:"btn-group"},kt=["onClick"],Mt=["onClick"];function Vt(d,s,e,i,o,r){const n=h("VueLoading"),k=h("font-awesome-icon"),M=h("PaginationComponent"),V=h("OrderModal");return c(),u(O,null,[m(n,{active:o.isLoading},null,8,["active"]),t("div",gt,[t("div",Ot,[bt,t("div",yt,[t("button",{class:v(["btn btn-outline-danger",{disabled:o.orders.length===0}]),type:"button",onClick:s[0]||(s[0]=(...l)=>r.delAllOrder&&r.delAllOrder(...l))},"清空訂單",2)])]),t("table",vt,[xt,t("tbody",null,[(c(!0),u(O,null,T(o.orders,l=>(c(),u("tr",{key:l.id},[t("td",null,a(r.formatDate(l.create_at)),1),t("td",null,a(l.id),1),t("td",null,"NT$ "+a(Math.round(l.total)),1),t("td",null,[t("span",{class:v({"text-primary":!l.is_paid})},a(l.is_paid?"已付款":"未付款"),3)]),t("td",null,[t("div",Tt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:b(C=>r.openOrderModal("edit",l),["prevent"])},[m(k,{icon:["fas","eye"]}),w(" 修改 ")],8,kt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:b(C=>r.delOneOrder(l.id),["prevent"])}," 刪除 ",8,Mt)])])]))),128))])]),m(M,{pages:o.pagination,onChangePage:r.getOrders},null,8,["pages","onChangePage"])]),m(V,{ref:"orderModal","temp-order":o.tempOrder,onUpdateOrder:r.getOrders},null,8,["temp-order","onUpdateOrder"])],64)}const At=x(ft,[["render",Vt]]);export{At as default};
