import{_ as w,r as _,o as p,c as f,d as a,w as N,n as g,F as v,b as t,f as u,i as y,t as o,j as V,e as D}from"./index-mK48P60-.js";import{S as E}from"./sweetalert2.all-qNhIK2og.js";const L={emits:["pay-item"],methods:{cardNum(e){return/\d{16}/.test(e)?!0:"請輸入正確信用卡數字"},validDate(e){return e?!0:"請選擇有效年/月"},securityNum(e){return/\d{3}/.test(e)?!0:"請輸入卡片背面末3碼數字"}}},S=t("h5",{class:"bg-dark text-light py-2 px-1"},"信用卡資訊",-1),T=t("label",{for:"cardNum",class:"form-label"},[u("信用卡卡號 "),t("span",{class:"text-danger"},"*")],-1),P=t("label",{for:"validDate",class:"form-label"},[u("有效年月 "),t("span",{class:"text-danger"},"*")],-1),k=t("label",{for:"securityNum",class:"form-label mt-20"},[u("安全碼 "),t("span",{class:"text-danger"},"*")],-1),C=t("div",{class:"text-end mt-24"},[t("button",{type:"submit",class:"btn btn-primary text-white mt-3 w-100"},"確認付款")],-1);function $(e,r,l,h,s,c){const i=_("VField"),d=_("ErrorMessage"),n=_("VForm");return p(),f(v,null,[S,a(n,{ref:"form",class:"px-12 py-16",onSubmit:r[0]||(r[0]=m=>e.$emit("pay-item"))},{default:N(({errors:m})=>[T,a(i,{id:"cardNum",name:"cardNum",type:"text",class:g(["form-control border-gray",{"is-invalid":m.cardNum}]),placeholder:"請輸入信用卡卡號",rules:c.cardNum,maxlength:"16"},null,8,["class","rules"]),a(d,{name:"cardNum",class:"invalid-feedback"}),P,a(i,{id:"validDate",name:"validDate",type:"month",class:g(["form-control border-gray",{"is-invalid":m.validDate}]),rules:c.validDate},null,8,["class","rules"]),a(d,{name:"validDate",class:"invalid-feedback"}),k,a(i,{id:"securityNum",name:"securityNum",type:"text",class:g(["form-control border-gray",{"is-invalid":m.securityNum}]),placeholder:"請輸入卡片背面末3碼",rules:c.securityNum,maxlength:"3"},null,8,["class","rules"]),a(d,{name:"securityNum",class:"invalid-feedback"}),C]),_:1},512)],64)}const j=w(L,[["render",$]]);var F={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"dorayu",BASE_URL:"/vite-deploy-week08/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:b,VITE_PATH:x}=F,O={data(){return{order:{},products:{},user:{},originPrice:0,isLoading:!1}},components:{CreditCard:j},methods:{getOrder(e){const r=`${b}/api/${x}/order/${e}`;this.isLoading=!0,this.axios.get(r).then(l=>{const{order:h}=l.data,{products:s,user:c}=h;this.isLoading=!1,this.order=h,this.products=s,this.user=c,Object.keys(s).forEach(i=>{const d=s[i];this.originPrice+=d.total})}).catch(l=>{y.error(l.response.data.message)}).finally(()=>{this.isLoading=!1})},getPay(e){const r=`${b}/api/${x}/pay/${e}`;this.isLoading=!0,this.axios.post(r).then(l=>{this.isLoading=!1,y.success(l.data.message),this.getOrder(e),this.$router.push("/orderfinish")}).catch(l=>{E.fire(l.response.data.message)}).finally(()=>{this.isLoading=!1})},formatDate(e){return new Date(e*1e3).toLocaleDateString()}},created(){const{id:e}=this.$route.params;this.getOrder(e)}},I={class:"container g-wrapper"},M=D('<div class="row d-flex justify-content-between align-items-center border-bottom py-4 my-5"><h2 class="cart-title col-12 col-md-2">購物車</h2><div class="cart-step col-12 col-md-10"><div class="box"><span class="deco">STEP1</span>購物車 </div><div class="box"><span class="deco">STEP2</span>訂購資訊 </div><div class="box current"><span class="deco">STEP3</span>確認付款 </div></div></div>',1),R={class:"row"},B={class:"col-12 col-lg-6"},U=t("h5",null,"訂單詳細資訊",-1),A={class:"bg-light my-4 p-4"},H={class:"table"},q=t("th",{scope:"row"},"訂單編號",-1),z=t("th",{scope:"row"},"訂購日期",-1),G=t("th",{scope:"row"},"是否付款",-1),J=t("th",{scope:"row"},"收件人姓名",-1),K=t("th",{scope:"row"},"收件人電話",-1),Q=t("th",{scope:"row"},"收件人Email",-1),W=t("th",{scope:"row"},"收件人地址",-1),X=t("th",{scope:"row"},"收件人留言",-1),Y={class:"col-12 col-lg-6"},Z=t("h5",{class:"mb-3"},"訂單明細",-1),tt={class:"table align-middle"},st=t("thead",{class:"table-dark"},[t("tr",null,[t("th",null,"圖片"),t("th",null,"品名"),t("th",null,"數量/單位"),t("th",{class:"text-end"},"價格")])],-1),et=["src"],ot={class:"text-end"},rt={class:"my-4"},lt={class:"border-bottom border-dark"},nt={class:"d-flex justify-content-between"},at=t("p",null,"商品總計：",-1),ct={class:"text-notoSans"},it={class:"d-flex justify-content-between"},dt=t("p",null,"優惠卷折扣：",-1),ut={class:"text-notoSans"},_t={class:"d-flex justify-content-between my-3"},ht=t("p",{class:"fw-bold"},"合計：",-1),mt={class:"fw-bold text-end text-primary"},pt={class:"text-notoSans fs-4"};function ft(e,r,l,h,s,c){const i=_("VueLoading"),d=_("CreditCard");return p(),f(v,null,[a(i,{active:s.isLoading},null,8,["active"]),t("div",I,[M,t("div",R,[t("div",B,[U,t("div",A,[t("table",H,[t("tbody",null,[t("tr",null,[q,t("td",null,o(s.order.id),1)]),t("tr",null,[z,t("td",null,o(c.formatDate(s.order.create_at)),1)]),t("tr",null,[G,t("td",null,[t("span",{class:g({"text-success":s.order.is_paid})},o(s.order.is_paid?"已付款":"未付款"),3)])]),t("tr",null,[J,t("td",null,o(s.user.name),1)]),t("tr",null,[K,t("td",null,o(s.user.tel),1)]),t("tr",null,[Q,t("td",null,o(s.user.email),1)]),t("tr",null,[W,t("td",null,o(s.user.address),1)]),t("tr",null,[X,t("td",null,o(s.order.message),1)])])])])]),t("div",Y,[Z,t("table",tt,[st,t("tbody",null,[(p(!0),f(v,null,V(s.products,n=>(p(),f("tr",{key:n.id},[t("td",null,[t("img",{class:"img-cart",src:n.product.imageUrl,alt:""},null,8,et)]),t("td",null,o(n.product.title),1),t("td",null,o(n.qty)+" / "+o(n.product.unit),1),t("td",ot,o(n.total),1)]))),128))])]),t("div",rt,[t("div",lt,[t("div",nt,[at,t("p",null,[u("NT$ "),t("span",ct,o(s.originPrice),1)])]),t("div",it,[dt,t("p",null,[u("NT$ "),t("span",ut,o(Math.floor(s.originPrice-s.order.total)),1)])])]),t("div",_t,[ht,t("p",mt,[u(" NT$ "),t("span",pt,o(Math.round(s.order.total)),1)])])]),a(d,{ref:"creditCard",onPayItem:r[0]||(r[0]=n=>c.getPay(s.order.id))},null,512)])])])],64)}const yt=w(O,[["render",ft]]);export{yt as default};
